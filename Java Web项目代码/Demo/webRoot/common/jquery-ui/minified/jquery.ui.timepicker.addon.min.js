(function(b){function a(){}a.prototype={$input:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,hour:0,minute:0,second:0,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",defaults:{holdDatepickerOpen:true,showButtonPanel:true,dateOnly:false,timeOnly:false,showHour:true,showMinute:true,showSecond:false,stepHour:0.05,stepMinute:0.05,stepSecond:0.05,ampm:false,hour:0,minute:0,second:0,timeFormat:"hh:mm"},addTimePicker:function(){var f=this;var d=this.$input.val();var e=this.defaults.timeFormat.toString().replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/t{1,2}/ig,"(am|pm|a|p)?").replace(/\s/g,"\\s?");var c=this.getFormatPositions();var g=d.match(new RegExp(e,"i"));if(g){if(c.t!==-1){this.ampm=((g[c.t]==undefined)?"":(g[c.t].charAt(0).toUpperCase()=="A")?"AM":"PM").toUpperCase()}if(c.h!==-1){if(this.ampm=="AM"&&g[c.h]=="12"){this.hour=0}else{if(this.ampm=="PM"&&g[c.h]!="12"){this.hour=(parseFloat(g[c.h])+12).toFixed(0)}else{this.hour=g[c.h]}}}if(c.m!==-1){this.minute=g[c.m]}if(c.s!==-1){this.second=g[c.s]}}setTimeout(function(){f.injectTimePicker(f)},10)},getFormatPositions:function(){var e=this.defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|t{1,2})/g);var d={h:-1,m:-1,s:-1,t:-1};if(e){for(var c=0;c<e.length;c++){if(d[e[c].toString().charAt(0)]==-1){d[e[c].toString().charAt(0)]=c+1}}}return d},injectTimePicker:function(d){var e=b("#"+b.datepicker._mainDivId);var c='<div id="ui-timepicker-div"><dl><dt id="ui_tpicker_time_label">\u65f6\u95f4</dt><dd id="ui_tpicker_time"></dd><dt id="ui_tpicker_hour_label"'+((d.defaults.showHour)?"":' style="display:none;"')+'>\u65f6</dt><dd id="ui_tpicker_hour"'+((d.defaults.showHour)?"":' style="display:none;"')+'></dd><dt id="ui_tpicker_minute_label"'+((d.defaults.showMinute)?"":' style="display:none;"')+'>\u5206</dt><dd id="ui_tpicker_minute"'+((d.defaults.showMinute)?"":' style="display:none;"')+'></dd><dt id="ui_tpicker_second_label"'+((d.defaults.showSecond)?"":' style="display:none;"')+'>\u79d2</dt><dd id="ui_tpicker_second"'+((d.defaults.showSecond)?"":' style="display:none;"')+"></dd></dl></div>";$tp=b(c);if(d.defaults.timeOnly==true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">Choose Time</div></div>');e.find(".ui-datepicker-header, .ui-datepicker-calendar, .ui-datepicker-current").hide()}d.hour_slider=$tp.find("#ui_tpicker_hour").slider({orientation:"horizontal",value:d.hour,max:23,step:d.defaults.stepHour,slide:function(){d.onTimeChange(d)}});d.minute_slider=$tp.find("#ui_tpicker_minute").slider({orientation:"horizontal",value:d.minute,max:59,step:d.defaults.stepMinute,slide:function(){d.onTimeChange(d)}});d.second_slider=$tp.find("#ui_tpicker_second").slider({orientation:"horizontal",value:d.second,max:59,step:d.defaults.stepSecond,slide:function(){d.onTimeChange(d)}});e.find(".ui-datepicker-calendar").after($tp);d.$timeObj=b("#ui_tpicker_time");d.onTimeChange(d)},onTimeChange:function(c){c.hour=parseFloat(c.hour_slider.slider("value")).toFixed(0);c.minute=parseFloat(c.minute_slider.slider("value")).toFixed(0);c.second=parseFloat(c.second_slider.slider("value")).toFixed(0);c.ampm=(c.hour<12)?"AM":"PM";c.formatTime(c);c.$timeObj.text(c.formattedTime)},formatTime:function(d){var e=d.defaults.timeFormat.toString();var c=((d.ampm=="AM")?(d.hour):(d.hour%12));c=(c==0)?12:c;if(d.defaults.ampm==true){e=e.toString().replace(/hh/g,((c<10)?"0":"")+c).replace(/h/g,c).replace(/mm/g,((d.minute<10)?"0":"")+d.minute).replace(/m/g,d.minute).replace(/ss/g,((d.second<10)?"0":"")+d.second).replace(/s/g,d.second).replace(/TT/g,d.ampm.toUpperCase()).replace(/tt/g,d.ampm.toLowerCase()).replace(/T/g,d.ampm.charAt(0).toUpperCase()).replace(/t/g,d.ampm.charAt(0).toLowerCase())}else{e=e.toString().replace(/hh/g,((d.hour<10)?"0":"")+d.hour).replace(/h/g,d.hour).replace(/mm/g,((d.minute<10)?"0":"")+d.minute).replace(/m/g,d.minute).replace(/ss/g,((d.second<10)?"0":"")+d.second).replace(/s/g,d.second);e=b.trim(e.replace(/t/gi,""))}d.formattedTime=e;return d.formattedTime},updateDateTime:function(c,d){var e=this.$input.datepicker("getDate");if(e==null){this.formattedDate=b.datepicker.formatDate(b.datepicker._get(c,"dateFormat"),new Date(),b.datepicker._getFormatConfig(c))}else{this.formattedDate=b.datepicker.formatDate(b.datepicker._get(c,"dateFormat"),e,b.datepicker._getFormatConfig(c))}this.formattedDateTime=this.formattedDate+" "+this.formattedTime;if(this.defaults.timeOnly==true){this.$input.val(this.formattedTime)}else{this.$input.val(this.formattedDateTime)}}};jQuery.fn.datetimepicker=function(d){var c=new a();if(d==undefined){d={}}c.defaults=b.extend({},c.defaults,d);if(!c.defaults.dateOnly){c.defaults=b.extend({},c.defaults,{beforeShow:function(e,f){c.hour=c.defaults.hour;c.minute=c.defaults.minute;c.second=c.defaults.second;c.ampm="";c.$input=b(e);c.inst=f;c.addTimePicker();if(b.isFunction(d.beforeShow)){d.beforeShow(e,f)}},onChangeMonthYear:function(e,g,f){c.addTimePicker();if(b.isFunction(d.onChangeMonthYear)){d.onChangeMonthYear(e,g,f)}},onClose:function(f,e){c.updateDateTime(e,c);if(b.isFunction(d.onClose)){d.onClose(f,e)}}})}b(this).datepicker(c.defaults);this.each(function(){var f=b(this);var e=b("<span />").attr("title","\u6e05\u7a7a\u65f6\u95f4").addClass("ui-icon").addClass("ui-icon-trash").css("display","inline-block").css("height","18px").css("cursor","pointer").css("margin-bottom","-3px");e.click(function(){f.val("")});f.after(e)})};jQuery.fn.timepicker=function(c){c=b.extend(c,{timeOnly:true});b(this).datetimepicker(c)};b.datepicker._selectDay=function(i,g,d,h){var f=b(i);if(b(h).hasClass(this._unselectableClass)||this._isDisabledDatepicker(f[0])){return}var e=this._getInst(f[0]);e.selectedDay=e.currentDay=b("a",h).html();e.selectedMonth=e.currentMonth=g;e.selectedYear=e.currentYear=d;this._selectDate(i,this._formatDate(e,e.currentDay,e.currentMonth,e.currentYear));var c=b("td."+this._currentClass);c.removeClass(this._currentClass);c.children("a").removeClass("ui-state-active");b(h).addClass(this._currentClass);b("a",h).addClass("ui-state-active")};b.datepicker._selectDate=function(h,c){var f=b(h);var e=this._getInst(f[0]);var g=(this._get(e,"holdDatepickerOpen")===true)?true:false;c=(c!=null?c:this._formatDate(e));if(e.input){e.input.val(c)}this._updateAlternate(e);var d=this._get(e,"onSelect");if(d){d.apply((e.input?e.input[0]:null),[c,e])}else{if(e.input){e.input.trigger("change")}}if(e.inline){this._updateDatepicker(e)}else{if(g){}else{this._hideDatepicker();this._lastInput=e.input[0];if(typeof(e.input[0])!="object"){e.input.focus()}this._lastInput=null}}}})(jQuery);
